{"version":3,"file":"main.js","mappings":"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","sources":["webpack://greact/./src/createElement.js","webpack://greact/webpack/bootstrap","webpack://greact/webpack/runtime/define property getters","webpack://greact/webpack/runtime/hasOwnProperty shorthand","webpack://greact/webpack/runtime/make namespace object","webpack://greact/./src/index.js"],"sourcesContent":["function createTextElement(text){\r\n    return {\r\n        type:'TEXT_ELEMENT',\r\n        props:{\r\n            nodeValue:text,\r\n            children:[]\r\n        }\r\n    }\r\n}\r\n\r\nfunction createElement(type,props,...children){\r\n    return {\r\n        type:type,\r\n        props:{\r\n            ...props,\r\n            children:children.map((child)=>{\r\n                return typeof child === 'object'?child:createTextElement(child)\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nexport {createElement}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { createElement } from \"./createElement\";\r\n//alternate 这个桥接属性是全体fiber 都用的一个属性，保存了fiber更新前的fiber tree\r\n\r\nwindow.GReact = {\r\n    createElement,\r\n    render,\r\n    useState,\r\n};\r\n\r\nfunction createDom(fiber) {\r\n    const dom =\r\n        fiber.type === \"TEXT_ELEMENT\"\r\n            ? document.createTextNode(\"\")\r\n            : document.createElement(fiber.type);\r\n    // const isProperty = (key) => key !== \"children\";\r\n    // Object.keys(fiber.props)\r\n    //     .filter(isProperty)\r\n    //     .forEach((name) => {\r\n    //         dom[name] = fiber.props[name];\r\n    //     });\r\n    updateDom(dom,{},fiber.props)\r\n    return dom;\r\n}\r\n//根节点，跟踪当前准备渲染的节点\r\nlet vipRoot = null;\r\n//下一个工作单元\r\nlet nextUnitOfWork = null;\r\n//当前渲染树 最后准备提交的渲染树\r\nlet currentRoot = null;\r\n\r\n// domdiff 要删除的节点\r\nlet deletions = null\r\n\r\nfunction commitRoot() {\r\n    deletions.forEach(commitWork)\r\n    commitWork(vipRoot.child);\r\n    currentRoot = vipRoot;\r\n    vipRoot = null;\r\n}\r\n\r\n//属性的更新\r\nconst isProperty = (key) => key !== 'children'\r\n//是否是新属性\r\nconst isNew = (prev,next) => (key) => prev[key] !== next[key]\r\n//是否是旧属性\r\nconst isGone = (next) => (key) => !(key in next)\r\n//是否是事件\r\nconst isEvent = (key) => key.startsWith('on')\r\nfunction updateDom(dom,prevProps,nextProps){\r\n    Object.keys(prevProps)\r\n    .filter(isProperty)\r\n    .filter(isGone(nextProps))\r\n    .forEach((key)=>{\r\n        dom[key] = ''\r\n    })\r\n\r\n    Object.keys(nextProps)\r\n    .filter(isProperty)\r\n    .filter(isNew(prevProps,nextProps))\r\n    .forEach((key)=>{\r\n        dom[key] = nextProps[key]\r\n    })\r\n\r\n    Object.keys(prevProps)\r\n    .filter(isEvent)\r\n    .filter((key) => !(key in nextProps) || isNew(prevProps,nextProps)(key))\r\n    .forEach((key)=>{\r\n        const eventType = key.toLowerCase().substring(2)\r\n        dom.removeEventListener(eventType,prevProps[key])\r\n    })\r\n\r\n\r\n    Object.keys(nextProps)\r\n    .filter(isEvent)\r\n    .filter(isNew(prevProps,nextProps))\r\n    .forEach((key)=>{\r\n        const eventType = key.toLowerCase().substring(2)\r\n        dom.addEventListener(eventType,nextProps[key])\r\n    })\r\n}\r\n\r\n//删除节点\r\nfunction commitDeletion(fiber,domParent) {\r\n    if (fiber.dom) {\r\n        domParent.removeChild(fiber.dom);\r\n    } else {\r\n        commitDeletion(fiber.child, domParent);\r\n    }\r\n}\r\n\r\n//更新渲染节点\r\nfunction commitWork(fiber) {\r\n    //effectTag 判断节点是不是需要删除的节点\r\n    if (!fiber) {\r\n        return;\r\n    }\r\n\r\n    //考虑到函数组件没有dom节点，所以要一直向上找到循环找到有dom节点的fiber\r\n    let domParentFiber = fiber.parent;\r\n    while(!domParentFiber.dom){\r\n        domParentFiber = domParentFiber.parent\r\n    }\r\n    const domParent = domParentFiber.dom;\r\n    if(fiber.effectTag === 'PLACEMENT' && fiber.dom !== null){\r\n        domParent.appendChild(fiber.dom)\r\n    }else if(fiber.effectTag === 'UPDATE' && fiber.dom !== null){\r\n        updateDom(fiber.dom,fiber.alternate.props,fiber.props)\r\n    }else if(fiber.effectTag === 'DELETION'){\r\n        commitDeletion(fiber,domParent)\r\n    }\r\n    commitWork(fiber.child);\r\n    commitWork(fiber.sibling);\r\n}\r\nfunction render(element, container) {\r\n    //第一个工作单元\r\n    vipRoot = {\r\n        dom: container,\r\n        props: {\r\n            children: [element],\r\n        },\r\n        alternate: currentRoot,\r\n    };\r\n    deletions = []\r\n    //下一个fiber节点（工作单元）跟节点\r\n    nextUnitOfWork = vipRoot;\r\n}\r\n\r\nfunction workLoop(deadline) {\r\n    //判断是否应该停止循环\r\n    let shuoldYield = false;\r\n    //如果存在下一个工作单元，且没有更高优先级得其它工作，执行循环\r\n    //如果存在上述得情况，直接打断渲染\r\n    while (nextUnitOfWork && !shuoldYield) {\r\n        nextUnitOfWork = performUnitOfWork(nextUnitOfWork);\r\n        //如果截止时间到了，停止工作循环，更高优先级得任务来了\r\n        shuoldYield = deadline.timeRemaining() < 1;\r\n    }\r\n    if (!nextUnitOfWork && vipRoot) {\r\n        commitRoot();\r\n    }\r\n    requestIdleCallback(workLoop);\r\n}\r\n//告知浏览器空闲时间执行workLoop\r\nrequestIdleCallback(workLoop);\r\n\r\n//新增全局变量 vipFiber\r\nlet vipFiber = null\r\nfunction useState(initial){\r\n    //是否有旧钩子，旧钩子存储了上一次更新的hook\r\n    const oldHooks = vipFiber.alternate && vipFiber.alternate.hooks;\r\n    const hookNum = vipFiber.alternate.hookNum\r\n    const oldHook = oldHooks && oldHooks.length > 0 && oldHooks[hookNum];\r\n    \r\n    //初始化钩子，钩子的状态是旧钩子的状态或者初始状态\r\n    const hook = {\r\n        state: oldHook ? oldHook.state : initial,\r\n        queue:[]\r\n    }\r\n\r\n    //从旧的钩子队列中获取所有动作，然后将它们一一应用到新的钩子状态\r\n    const actions = oldHook ? oldHook.queue : [];\r\n    actions.forEach(action => {\r\n        hook.state = action(hook.state)\r\n    })\r\n\r\n    const setState = (action) => {\r\n        hook.queue.push(action)\r\n\r\n        //更新渲染\r\n        vipRoot = {\r\n            dom:currentRoot.dom,\r\n            props:currentRoot.props,\r\n            alternate:currentRoot\r\n        }\r\n        nextUnitOfWork = vipRoot;\r\n        deletions = []\r\n    }\r\n\r\n    vipFiber.hooks.push(hook);\r\n    vipFiber.hookNum ++\r\n    return [hook.state,setState]\r\n}\r\n\r\n//更新函数组件\r\nfunction updateFunctionComponent(fiber) {\r\n    vipFiber = fiber;\r\n    vipFiber.hooks = [];\r\n    vipFiber.hookNum = 0;\r\n    const children = [fiber.type(fiber.props)];\r\n    reconcileChildren(fiber,children);\r\n}\r\n\r\n//更新原生组件\r\nfunction updateHostComponent(fiber) {\r\n    if (!fiber.dom) {\r\n        fiber.dom = createDom(fiber);\r\n    }\r\n    const elements = fiber.props.children\r\n    reconcileChildren(fiber, elements)\r\n}\r\n\r\n//承载了下一个得工作单元\r\nfunction performUnitOfWork(fiber) {\r\n\r\n    const isFunctionComponent = fiber && fiber.type instanceof Function;\r\n    if(isFunctionComponent){\r\n        updateFunctionComponent(fiber)\r\n    }else{\r\n        updateHostComponent(fiber)\r\n    }\r\n\r\n    // if (!fiber.dom) {\r\n    //     fiber.dom = createDom(fiber);\r\n    // }\r\n    // const elements = fiber.props.children\r\n    // reconcileChildren(fiber, elements)\r\n\r\n    //如果有子节点，返回子节点\r\n    if (fiber.child) {\r\n        return fiber.child;\r\n    }\r\n    let nextFiber = fiber;\r\n    //这儿是重点，如果没有子节点，则判断有没有兄弟节点\r\n    //如果没有判断父节点有没有兄弟节点，直至找到第一个有兄弟节点的父节点\r\n    while (nextFiber) {\r\n        if (nextFiber.sibling) {\r\n            return nextFiber.sibling;\r\n        }\r\n        nextFiber = nextFiber.parent;\r\n    }\r\n}\r\n\r\n//这里对比新旧的fiber\r\nfunction reconcileChildren(vipFiber, elements) {\r\n    //如果fiber没有dom节点，创建一个dom节点\r\n    // if(fiber.parent){\r\n    //     fiber.parent.dom.appendChild(fiber.dom);\r\n    // }\r\n    //处理children节点\r\n    let index = 0; //起始节点\r\n    let oldFiber = vipFiber.alternate && vipFiber.alternate.child\r\n    let prevSibling = null; //兄弟节点\r\n    while (index < elements.length || !!oldFiber) {\r\n        // while (index < elements.length)\r\n        const element = elements[index];\r\n        const newFiber = null;\r\n        //判断fiber的类型是否一致\r\n        const sameType = oldFiber && element && element.type === oldFiber.type\r\n        if (sameType) {\r\n            //如果类型一致 仅仅去更新props\r\n            newFiber = {\r\n                type: oldFiber.type,\r\n                props: element.props,\r\n                dom: oldFiber.dom,\r\n                parent: vipFiber,\r\n                alternate: oldFiber,\r\n                effectTag: 'UPDATE',\r\n            }\r\n        }\r\n        //添加新节点\r\n        if (element && !sameType) {\r\n            newFiber = {\r\n                type: element.type,\r\n                props: element.props,\r\n                dom: null,\r\n                parent: vipFiber,\r\n                alternate: null,\r\n                effectTag: 'PLACEMENT',\r\n            }\r\n        }\r\n        //删除老节点\r\n        if (oldFiber && !sameType) {\r\n            oldFiber.effectTag = 'DELETION'\r\n            deletions.push(oldFiber)\r\n        }\r\n        if(oldFiber){\r\n            oldFiber = oldFiber.sibling\r\n        }\r\n        if (index === 0) {\r\n            vipFiber.child = newFiber;\r\n        } else {\r\n            //这儿通过链把兄弟节点依次挂载到父节点下面的第一个子节点上\r\n            //用于后面找到兄弟节点\r\n            prevSibling.sibling = newFiber;\r\n        }\r\n        prevSibling = newFiber;\r\n        index++;\r\n    }\r\n\r\n}\r\n\r\nconst style = {\r\n    width:'100px',\r\n    height:'100px',\r\n    backgroundColor:'red'\r\n}\r\n\r\n/* @jsx GReact.createElement */\r\n// function App(props){\r\n//     return <div style = {style}>\r\n//         <h1>{props.name}</h1>\r\n//     </div>\r\n// }\r\n// const element = <App name='foo'/>\r\n// const root = document.getElementById(\"root\");\r\n// GReact.render(element, root);\r\n\r\nfunction Counter(){\r\n    const [count, setCount] = GReact.useState(0);\r\n    const [count1, setCount1] = GReact.useState(2);\r\n    return <h1 onClick = {()=>{setCount((c)=>c+1);setCount1((c)=>c+1)}}>Count:{count}--{count1}</h1>\r\n}\r\nconst element = <Counter/>\r\nconst root = document.getElementById(\"root\");\r\nGReact.render(element, root);\r\n\r\n\r\n\r\n\r\n"],"names":["createTextElement","text","type","props","nodeValue","children","createElement","map","child","window","GReact","render","useState","createDom","fiber","dom","document","createTextNode","updateDom","vipRoot","nextUnitOfWork","currentRoot","deletions","commitRoot","forEach","commitWork","isProperty","key","isNew","prev","next","isGone","isEvent","startsWith","prevProps","nextProps","Object","keys","filter","eventType","toLowerCase","substring","removeEventListener","addEventListener","commitDeletion","domParent","removeChild","domParentFiber","parent","effectTag","appendChild","alternate","sibling","element","container","workLoop","deadline","shuoldYield","performUnitOfWork","timeRemaining","requestIdleCallback","vipFiber","initial","oldHooks","hooks","hookNum","oldHook","length","hook","state","queue","actions","action","setState","push","updateFunctionComponent","reconcileChildren","updateHostComponent","elements","isFunctionComponent","Function","nextFiber","index","oldFiber","prevSibling","newFiber","sameType","style","width","height","backgroundColor","Counter","count","setCount","count1","setCount1","c","root","getElementById"],"sourceRoot":""}